<!DOCTYPE html>
<html layout:decorate="~{layout}">
<head>
<meta charset="UTF-8" />
<section layout:fragment="corpo">

	<div class="container" style="margin-top: 30px;">

		<!-- Stack the columns on mobile by making one full-width and the other half-width -->
		<div class="row">
			<div class="col-12 col-md-6">
				<div class="card mb-3">
					<img class="card-img-top" th:src="${veiculo.arquivos[0].nome}"
						alt="Card image cap">
					<ul class="list-group list-group-flush">
						<li class="list-group-item">Nome: <a
							th:text="${veiculo.nome}"></a></li>
						<li class="list-group-item">Marca:<a
							th:text="${veiculo.tipoMarca.marca.nome}"></a></li>
						<li class="list-group-item">Categoria: <a
							th:text="${veiculo.categoria.nome}"></a></li>
						<li class="list-group-item">Preço: <a id="preco"
							th:text="${veiculo.categoria.valor}"></a></li>

					</ul>
				</div>

			</div>
			<div class="col-12 col-md-6">
				<div class="card card-signin">
					<div class="card-body">
						<h5 class="card-title text-center">Pague com o Cartão de
							créditos</h5>
						<hr>


						<form method="POST" th:action=@{/locacao/pagar}
							th:object="${veiculo}" enctype="multipart/form-data">
							<div class="form-group">
								<label>Seguro(ex:Normal/Vip)</label> <select id="seguro"
									class="form-control" th:field="*{seguro}">
									<option value="">Selecione</option>
									<option th:each="s : ${seguros}" th:value="${s.id}"
										th:text="${s.nome} + ' R$' + ${s.preco}"></option>
								</select>
							</div>

							<div class="form-group">
								<label>Local de Devolucao</label> <select id="locadoraDevolucao"
									class="form-control" th:field="*{locadoraDevolucao}">
									<option value="">Selecione</option>
									<option th:each="l : ${locadoras}" th:value="${l.id}"
										th:text="${l.localLocadora.nome}"></option>
								</select>
							</div>

							<input type="hidden" name="dataRetirada" id="dataRetirada"
								class="form control">
							<div class="form-group">
								<label for="dataEntrega">Data Entrega</label> <input type="date"
									class="form-control" id="dataEntrega" name="dataEntrega" />
								<div class="invalid-feedback"></div>
							</div>


							<input type="hidden" th:value="${veiculo.id}" name="veiculo"
								id="veiculo" class="form control"> <input type="hidden"
								id="valorTotal" name="valorTotal" class="form control">

							<div class="form-group" style="text-align: right;">
								<button type="submit" class="btn btn-primary">Pagar
									Locação</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
</section>
</body>
</html>
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"
	integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
	crossorigin="anonymous"></script>
<script type="text/javascript">
	$(document).ready(
			function() {
				const DAY = 24 * 60 * 60 * 1000;
				var data1 = new Date(2020, 11, 30);
				var data2 = new Date(2020, 11, 06);

				/*Formatando data de retirada*/
				var ano = data1.getFullYear();
				var mes = data1.getMonth();
				var dia = data1.getDate();
				var dataFormatada = dia + "/" + mes + "/" + ano;
				$("#dataRetirada").val(dataFormatada);
				console.log(dataFormatada);

				/*Formartando data de entrega*/
				var ano2 = data2.getFullYear();
				var mes2 = data2.getMonth();
				var dia2 = data2.getDate();

				var dataFormatada2 = dia2 + "/" + mes2 + "/" + ano2;
				$("#dataEntrega").val(dataFormatada2);
				console.log(dataFormatada2);

				var calcMlsdata1 = data1.getTime();
				var calcMlsdata2 = data2.getTime();
				var diferenca = calcMlsdata2 - calcMlsdata1;
				var qtdDias = diferenca / DAY;
				console.log(qtdDias);
				var array;
				var valorSeguro = 0;
				var valorFinal = 0;
				$("#diarias").text(qtdDias);
				var precoVeiculo = $('#preco').text();
				console.log(precoVeiculo);
				$('#seguro').change(
						function() {

							var valor = $('#seguro option:selected').val();
							var nome = $('#seguro option:selected').text();
							if (valor != "") {

								console.log(valor);
								console.log(nome);

								array = nome.split("R$");
								console.log(array[0]);
								valorSeguro = array[1];
								console.log(valorSeguro);
								$("#valorSeguro").text(valorSeguro);

								valorFinal = (precoVeiculo * qtdDias)
										+ (valorSeguro * qtdDias);

								$("#valorLocacao").text(valorFinal);
								$("#valorTotal").val(valorFinal);
							} else {
								valorFinal = (precoVeiculo * qtdDias);
								valorSeguro = 0;
								$("#valorSeguro").text(valorSeguro);
								console.log(valorFinal);
								$("#valorLocacao").text(valorFinal);
								$("#valorTotal").val(valorFinal)

							}
						});

			});
</script>
</script>



